<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>039 Photos ‚Äî Gallery</title>
  <style>
    :root{
      --accent:#0078ff;
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#111827;
    }
    header{
      background:linear-gradient(90deg,var(--accent),#00c6ff);
      color:white;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    header h1{margin:0;font-size:18px;}
    .admin-btn{background:rgba(255,255,255,0.15);border:0;color:white;padding:8px 10px;border-radius:8px;cursor:pointer}
    nav{display:flex;gap:6px;padding:10px;background:#fff;border-bottom:1px solid #eee;justify-content:center;flex-wrap:wrap}
    nav button{background:none;border:0;padding:10px 14px;cursor:pointer;border-radius:8px;font-weight:600;color:var(--muted)}
    nav button.active{background:linear-gradient(90deg,var(--accent),#00c6ff);color:white}
    main{max-width:1100px;margin:18px auto;padding:0 12px}
    .upload-card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center}
    input[type=file]{padding:6px}
    select{padding:8px;border-radius:8px;border:1px solid #e5e7eb}
    .upload-btn{background:var(--accent);color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);position:relative}
    .card img,.card video{width:100%;height:160px;object-fit:cover;border-radius:8px;display:block}
    .delete-btn{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.6);color:white;border:0;padding:6px 8px;border-radius:8px;cursor:pointer;display:none}
    .meta{margin-top:6px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between}
    .albums-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .album-row{background:var(--card);padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
    .small{font-size:13px;color:var(--muted)}
    @media (max-width:640px){
      .card img,.card video{height:120px}
    }
  </style>
</head>
<body>
  <header>
    <h1>üì∏ 039 Photos</h1>
    <button class="admin-btn" id="adminBtn">üîê Admin</button>
  </header>

  <nav>
    <button id="tab-all" class="active" onclick="changeTab('all')">All Media</button>
    <button id="tab-photos" onclick="changeTab('photos')">Photos</button>
    <button id="tab-videos" onclick="changeTab('videos')">Videos</button>
    <button id="tab-albums" onclick="changeTab('albums')">Albums</button>
  </nav>

  <main>
    <section class="upload-card">
      <input id="fileInput" type="file" accept="image/*,video/*" multiple />
      <select id="monthSelect">
        <option value="">Select month</option>
        <option>January</option><option>February</option><option>March</option>
        <option>April</option><option>May</option><option>June</option>
        <option>July</option><option>August</option><option>September</option>
        <option>October</option><option>November</option><option>December</option>
      </select>
      <button class="upload-btn" id="uploadBtn">Upload</button>
    </section>

    <div id="gallery" class="gallery"></div>
  </main>

  <script type="module">
    // ‚ö†Ô∏è Replace these with your own Supabase values before uploading
    const SUPABASE_URL = "https://cksuswghafnksktbkbvg.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrc3Vzd2doYWZua3NrdGJrYnZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MzU4NjAsImV4cCI6MjA3NzMxMTg2MH0.xvlF24-bse44uqnc35ew4KMqw_qIZYcIedT6zIhQXCM";

    const ADMIN_PASSWORD = "harsha@112";
    const BUCKET = "photos";

    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const fileInput = document.getElementById('fileInput');
    const monthSelect = document.getElementById('monthSelect');
    const uploadBtn = document.getElementById('uploadBtn');
    const gallery = document.getElementById('gallery');
    const adminBtn = document.getElementById('adminBtn');

    let isAdmin = false;
    let currentTab = "all";

    window.changeTab = (tab) => {
      currentTab = tab;
      document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
      document.getElementById("tab-" + tab).classList.add("active");
      loadGallery();
    };

    adminBtn.addEventListener('click', () => {
      const pass = prompt("Enter admin password:");
      if (pass === ADMIN_PASSWORD) {
        isAdmin = true;
        alert("Admin access granted");
        document.querySelectorAll('.delete-btn').forEach(b=>b.style.display='inline-block');
      } else alert("Wrong password");
    });

    uploadBtn.addEventListener('click', async () => {
      const files = fileInput.files;
      const month = monthSelect.value;
      if (!month) return alert("Please select a month!");
      if (!files.length) return alert("Please select files!");
      uploadBtn.disabled = true;
      uploadBtn.textContent = "Uploading...";
      for (const file of files) {
        const safe = `${Date.now()}_${file.name.replace(/\s+/g,'_')}`;
        const path = `${month}/${safe}`;
        const { error } = await supabase.storage.from(BUCKET).upload(path, file);
        if (error) console.error(error);
      }
      uploadBtn.disabled = false;
      uploadBtn.textContent = "Upload";
      fileInput.value = "";
      monthSelect.value = "";
      alert("Upload complete!");
      loadGallery();
    });

    async function listAll() {
      const { data, error } = await supabase.storage.from(BUCKET).list('', { limit: 1000 });
      if (error) return [];
      return data;
    }

    function publicUrl(path) {
      const { data } = supabase.storage.from(BUCKET).getPublicUrl(path);
      return data.publicUrl;
    }

    async function deleteFile(path) {
      if (!isAdmin) return alert("Admin only");
      if (!confirm("Delete this file?")) return;
      const { error } = await supabase.storage.from(BUCKET).remove([path]);
      if (error) console.error(error);
      else loadGallery();
    }
    window.deleteFile = deleteFile;

    async function loadGallery() {
      gallery.innerHTML = "Loading...";
      const { data, error } = await supabase.storage.from(BUCKET).list('', { limit: 1000 });
      if (error || !data.length) {
        gallery.innerHTML = "<p>No files found</p>";
        return;
      }
      gallery.innerHTML = "";
      const items = [];
      for (const obj of data) {
        const path = obj.name;
        const ext = path.split('.').pop().toLowerCase();
        const isVideo = ['mp4','webm','mov','ogg'].includes(ext);
        items.push({ path, isVideo });
      }

      let filtered = items;
      if (currentTab === "photos") filtered = items.filter(i=>!i.isVideo);
      if (currentTab === "videos") filtered = items.filter(i=>i.isVideo);

      const monthMap = {};
      for (const it of filtered) {
        const month = it.path.split('/')[0] || "Unknown";
        if (!monthMap[month]) monthMap[month] = [];
        monthMap[month].push(it);
      }

      if (currentTab === "albums") {
        for (const month of Object.keys(monthMap)) {
          const list = document.createElement('div');
          list.className = "album-row";
          list.innerHTML = `<div><strong>${month}</strong></div>
            <div><button onclick="openAlbum('${month}')">Open</button></div>`;
          gallery.appendChild(list);
        }
        return;
      }

      for (const it of filtered) {
        const url = publicUrl(it.path);
        const card = document.createElement("div");
        card.className = "card";
        const media = it.isVideo 
          ? `<video src="${url}" controls></video>` 
          : `<img src="${url}" alt="">`;
        const delBtn = `<button class="delete-btn" style="${isAdmin?'display:inline-block':'display:none'}" onclick="deleteFile('${it.path}')">Delete</button>`;
        card.innerHTML = media + delBtn + `<div class="meta"><div>${it.path.split('/')[0]}</div></div>`;
        gallery.appendChild(card);
      }
    }

    window.openAlbum = async (month) => {
      gallery.innerHTML = `<button onclick="changeTab('albums')">‚Üê Back</button>`;
      const { data } = await supabase.storage.from(BUCKET).list(month, { limit: 1000 });
      if (!data.length) return gallery.innerHTML += "<p>No files</p>";
      for (const obj of data) {
        const path = `${month}/${obj.name}`;
        const url = publicUrl(path);
        const ext = path.split('.').pop().toLowerCase();
        const isVideo = ['mp4','webm','mov','ogg'].includes(ext);
        const card = document.createElement('div');
        card.className = "card";
        const media = isVideo ? `<video src="${url}" controls></video>` : `<img src="${url}">`;
        const delBtn = `<button class="delete-btn" style="${isAdmin?'display:inline-block':'display:none'}" onclick="deleteFile('${path}')">Delete</button>`;
        card.innerHTML = media + delBtn + `<div class="meta"><div>${month}</div></div>`;
        gallery.appendChild(card);
      }
    };

    loadGallery();
    setInterval(loadGallery, 60000);
  </script>
</body>
</html>
