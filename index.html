 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>039 Photos</title>
<style>
  body{font-family:sans-serif;margin:0;background:#fafafa;color:#222}
  header{background:#222;color:#fff;text-align:center;padding:1rem}
  #tabs{display:flex;justify-content:center;gap:1rem;background:#eee;padding:.5rem}
  #tabs button{border:none;background:#ddd;padding:.5rem 1rem;border-radius:.5rem}
  #tabs button.active{background:#222;color:#fff}
  form{text-align:center;margin:1rem}
  input{margin:.3rem;padding:.4rem}
  .media-container{display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center}
  .gallery-img,.gallery-video{width:150px;height:150px;object-fit:cover;border-radius:8px}
  .delete-btn{display:none;background:crimson;color:#fff;border:none;padding:.3rem .5rem;border-radius:4px;margin-top:.2rem}
  #admin-btn{position:fixed;bottom:1rem;right:1rem;padding:.6rem 1rem;background:#333;color:#fff;border:none;border-radius:1rem}
</style>
</head>
<body>
<header><h1>039 Photos</h1></header>

<div id="tabs">
  <button id="allTab" class="active" onclick="filterTab('all')">All Media</button>
  <button onclick="filterTab('photos')">Photos</button>
  <button onclick="filterTab('videos')">Videos</button>
</div>

<form id="uploadForm">
  <input type="file" id="fileInput" multiple accept="image/*,video/*" required>
  <button type="submit">Upload</button>
</form>

<div id="gallery" class="media-container"></div>
<button id="admin-btn" onclick="adminLogin()">üîê Admin</button>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // üëá Replace these two lines with your actual Supabase details
  const SUPABASE_URL = "https://cksuswghafnksktbkbvg.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrc3Vzd2doYWZua3NrdGJrYnZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3MzU4NjAsImV4cCI6MjA3NzMxMTg2MH0.xvlF24-bse44uqnc35ew4KMqw_qIZYcIedT6zIhQXCM";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  const bucketName = "photos";

  const ADMIN_PASSWORD = "harsha@112";
  let isAdmin = false;

  function adminLogin(){
    const entered = prompt("Enter admin password:");
    if(entered===ADMIN_PASSWORD){
      isAdmin=true;
      alert("Admin access granted");
      showDeleteButtons();
    }else alert("Wrong password");
  }

  function showDeleteButtons(){
    document.querySelectorAll(".delete-btn").forEach(btn=>btn.style.display="inline-block");
  }

  document.getElementById("uploadForm").addEventListener("submit",uploadFiles);

  async function uploadFiles(e){
    e.preventDefault();
    const files=document.getElementById("fileInput").files;
    if(files.length===0)return alert("Choose files first!");
    for(const file of files){
      const {error}=await supabase.storage.from(bucketName).upload(file.name,file,{upsert:true});
      if(error){console.error(error);alert("Failed: "+file.name);}
    }
    alert("Upload complete!");
    loadGallery();
  }

  async function loadGallery(){
    const gallery=document.getElementById("gallery");
    gallery.innerHTML="<p>Loading...</p>";
    try{
      const {data, error}=await supabase.storage.from(bucketName).list("",{limit:1000,sortBy:{column:"name",order:"asc"}});
      if(error)throw error;
      gallery.innerHTML="";
      for(const file of data){
        if(!file.name)continue;
        const {data:pub}=supabase.storage.from(bucketName).getPublicUrl(file.name);
        const ext=file.name.split(".").pop().toLowerCase();
        const wrap=document.createElement("div");
        if(["jpg","jpeg","png","gif","webp"].includes(ext)){
          const img=document.createElement("img");
          img.src=pub.publicUrl;
          img.className="gallery-img media-photo";
          wrap.appendChild(img);
        }else if(["mp4","mov","webm","avi"].includes(ext)){
          const vid=document.createElement("video");
          vid.src=pub.publicUrl;
          vid.controls=true;
          vid.className="gallery-video media-video";
          wrap.appendChild(vid);
        }
        if(isAdmin){
          const del=document.createElement("button");
          del.textContent="Delete";
          del.className="delete-btn";
          del.onclick=()=>deleteMedia(file.name,wrap);
          wrap.appendChild(del);
        }
        gallery.appendChild(wrap);
      }
      if(!gallery.innerHTML.trim())gallery.innerHTML="<p>No media yet.</p>";
    }catch(err){
      console.error(err);
      gallery.innerHTML="<p>Error loading gallery.</p>";
    }
  }

  async function deleteMedia(path,element){
    if(!confirm("Delete this item?"))return;
    const {error}=await supabase.storage.from(bucketName).remove([path]);
    if(error){alert("Delete failed.");}else{element.remove();}
  }

  function filterTab(tab){
    document.querySelectorAll("#tabs button").forEach(b=>b.classList.remove("active"));
    if(tab==="all")document.getElementById("allTab").classList.add("active");
    const photos=document.querySelectorAll(".media-photo");
    const videos=document.querySelectorAll(".media-video");
    photos.forEach(p=>p.parentElement.style.display=(tab==="all"||tab==="photos")?"":"none");
    videos.forEach(v=>v.parentElement.style.display=(tab==="all"||tab==="videos")?"":"none");
  }

  window.onload=loadGallery;
</script>
</body>
</html>
